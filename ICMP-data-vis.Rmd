---
title: "ICMP data visualisation"
author: "Bevan Weir"
date: "19 October 2021"
affiliation: "Manaaki Whenua - Landcare Research"
subject: "Nationally significant collections"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

This is an R Markdown document for statistics derived from specimen data of the ICMP culture collection https://www.landcareresearch.co.nz/icmp. This is an experimental showcase of presenting visulisations of data analysed in R in a user-freindly format.

This data excludes all deaccessioned cultures, but includes different specimen security levels such as 'confidential'.

```{r import, include=FALSE}
#import the files
ICMP.dump.initial <- read.csv("ICMP-export-27-jun-2021.csv", header=TRUE, sep=",")

#load all packages needed
library(tidyverse)
library(ggplot2)
library(lubridate)

#subset the data
#tidyverse way of sub setting - remove viruses and deaccessioned cultures
ICMP.dump <- ICMP.dump.initial %>%
  filter(SpecimenType == "Bacterial Culture" | 
           SpecimenType == "Chromist Culture" | 
           SpecimenType == "Fungal Culture" | 
           SpecimenType == "Yeast Culture") %>%
  filter(Deaccessioned == "false")
```



## General stats

Here include:

* number of specimens
* number of types
* number at each security level
* NZ versus overseas


```{r tables, echo=TRUE}

table(ICMP.dump$SpecimenType)

```

## Type cultures

The ICMP has a number of type cultures.

```{r types, echo=TRUE}

ICMP.types <- subset(ICMP.dump,!(TypeStatus == ""))
table(ICMP.types$SpecimenType)

```

There are different 'kinds' of types. Bacterial types are 'type strains', bacterial pathovars are 'pathotype strains'. Fungal type cultures may have been isolated from a type specimen and are thus 'ex types'.

```{r types chart, echo=TRUE}

#barchart of all ICMP types sorted by 'kind' of type, coloured by kind of organism
ICMP.types <- subset(ICMP.dump,!(TypeStatus == ""))
ggplot(ICMP.types, aes(TypeStatus, fill=SpecimenType)) +
  labs(title = "Types in the ICMP") +
  labs(x = "'Kind' of type", y = "number of cultures") +
  geom_bar() + 
  coord_flip()

```

## Curation stats

These stats are for curation.

```{r last updated user chart, echo=TRUE}

#pie chart by last updated user
ICMP.dump$LastUpdatedBy <- sapply(ICMP.dump$UpdatedBy, tolower)
ggplot(ICMP.dump, aes(x=factor(1), fill=LastUpdatedBy)) +
  labs(title = "Last User to update an ICMP record") +
  geom_bar(width = 1) +
  coord_polar("y") +
  theme_void() +
  scale_fill_brewer(palette = "Paired")

```
